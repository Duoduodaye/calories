<!-- pages/record/record.wxml -->
<view class="container">
  
  <!-- é¤æ¬¡é€‰æ‹© (ä»…é£Ÿç‰©è®°å½•æ˜¾ç¤º) -->
  <view wx:if="{{ recordType === 'food' }}" class="card">
    <view class="meal-selector">
      <scroll-view scroll-x="true" class="meal-scroll">
        <view class="meal-tabs">
          <view wx:for="{{ mealTypes }}" wx:key="type" 
                class="meal-tab {{ selectedMeal === item.type ? 'active' : '' }} {{ item.isMain ? '' : 'snack-tab' }}" 
                bindtap="selectMeal" 
                data-meal="{{ item.type }}">
            <text>{{ item.name }}</text>
            <view wx:if="{{ !item.isMain }}" class="tab-snack-dot"></view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
  
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="card">
    <view class="page-title">
      <text wx:if="{{ recordType === 'food' }}">ğŸ½ï¸ è®°å½•é£Ÿç‰©æ‘„å…¥</text>
      <text wx:else>ğŸƒâ€â™‚ï¸ è®°å½•è¿åŠ¨æ¶ˆè€—</text>
    </view>
  </view>
  
  <!-- æœç´¢æ¡† -->
  <view class="card">
    <view class="search-box">
      <input class="search-input" 
             placeholder="{{ recordType === 'food' ? 'æœç´¢é£Ÿç‰©åç§°' : 'æœç´¢è¿åŠ¨åç§°' }}" 
             value="{{ searchKeyword }}" 
             bindinput="onSearchInput" />
      <button wx:if="{{ searchKeyword }}" class="clear-btn" bindtap="clearSearch">Ã—</button>
    </view>
  </view>
  
  <!-- åˆ†ç±»é€‰æ‹© -->
  <view class="card">
    <view class="category-tabs">
      <scroll-view scroll-x="true" class="category-scroll">
        <view class="category-list">
          <view wx:for="{{ recordType === 'food' ? categories : exerciseCategories }}" wx:key="*this" 
                class="category-tab {{ selectedCategory === item ? 'active' : '' }}" 
                bindtap="selectCategory" 
                data-category="{{ item }}">
            <text>{{ item }}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
  
  <!-- é£Ÿç‰©åˆ—è¡¨ -->
  <view wx:if="{{ recordType === 'food' }}" class="food-list">
    <view wx:for="{{ filteredFoods }}" wx:key="id" 
          class="card food-item" 
          bindtap="selectFood" 
          data-food="{{ item }}">
      <view class="food-info">
        <view class="food-name">{{ item.name }}</view>
        <view class="food-details">
          <text class="food-category">{{ item.category }}</text>
          <text class="food-calories">{{ item.calories }}åƒå¡/100g</text>
        </view>
        <view class="food-nutrition">
          <text class="nutrition-item">è›‹ç™½è´¨: {{ item.protein }}g</text>
          <text class="nutrition-item">è„‚è‚ª: {{ item.fat }}g</text>
          <text class="nutrition-item">ç¢³æ°´: {{ item.carbs }}g</text>
        </view>
      </view>
      <view class="food-action">
        <text class="add-icon">+</text>
      </view>
    </view>
  </view>
  
  <!-- è¿åŠ¨åˆ—è¡¨ -->
  <view wx:if="{{ recordType === 'exercise' }}" class="exercise-list">
    <view wx:for="{{ filteredExercises }}" wx:key="id" 
          class="card exercise-item" 
          bindtap="selectExercise" 
          data-exercise="{{ item }}">
      <view class="exercise-info">
        <view class="exercise-header">
          <text class="exercise-icon">{{ item.icon }}</text>
          <view class="exercise-main">
            <view class="exercise-name">{{ item.name }}</view>
            <view class="exercise-details">
              <text class="exercise-category">{{ item.category }}</text>
              <text class="exercise-calories">{{ item.caloriesPerMin }}åƒå¡/åˆ†é’Ÿ</text>
            </view>
          </view>
        </view>
      </view>
      <view class="exercise-action">
        <text class="add-icon">+</text>
      </view>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{ (recordType === 'food' && filteredFoods.length === 0) || (recordType === 'exercise' && filteredExercises.length === 0) }}" class="empty-state">
    <text class="text-muted">{{ recordType === 'food' ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³é£Ÿç‰©' : 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è¿åŠ¨' }}</text>
  </view>
  
</view>

<!-- é£Ÿç‰©é‡é‡è¾“å…¥å¼¹çª— -->
<view wx:if="{{ showWeightModal }}" class="modal-overlay" bindtap="closeWeightModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">æ·»åŠ  {{ selectedFood.name }}</text>
      <button class="modal-close" bindtap="closeWeightModal">Ã—</button>
    </view>
    
    <view class="modal-body">
      <view class="food-summary">
        <text class="food-calories-per-100g">{{ selectedFood.calories }}åƒå¡/100g</text>
      </view>
      
      <view class="weight-input" catchtap="stopPropagation">
        <text class="input-label">é‡é‡ï¼ˆå…‹ï¼‰</text>
        <input class="input" 
               type="number" 
               placeholder="è¯·è¾“å…¥é‡é‡" 
               value="{{ inputWeight }}" 
               bindinput="onWeightInput" 
               catchtap="stopPropagation" />
      </view>
      
      <view class="quick-weights" catchtap="stopPropagation">
        <text class="input-label">å¿«é€Ÿé€‰æ‹©</text>
        <view class="weight-buttons">
          <button wx:for="{{ quickWeights }}" wx:key="*this" 
                  class="btn-secondary weight-btn" 
                  catchtap="selectQuickWeight" 
                  data-weight="{{ item }}">{{ item }}g</button>
        </view>
      </view>
      
      <view wx:if="{{ calculatedNutrition }}" class="nutrition-preview">
        <text class="input-label">è¥å…»æˆåˆ†é¢„è§ˆ</text>
        <view class="nutrition-grid">
          <view class="nutrition-item">
            <text class="nutrition-label">çƒ­é‡</text>
            <text class="nutrition-value">{{ calculatedNutrition.calories }}åƒå¡</text>
          </view>
          <view class="nutrition-item">
            <text class="nutrition-label">è›‹ç™½è´¨</text>
            <text class="nutrition-value">{{ calculatedNutrition.protein }}g</text>
          </view>
          <view class="nutrition-item">
            <text class="nutrition-label">è„‚è‚ª</text>
            <text class="nutrition-value">{{ calculatedNutrition.fat }}g</text>
          </view>
          <view class="nutrition-item">
            <text class="nutrition-label">ç¢³æ°´</text>
            <text class="nutrition-value">{{ calculatedNutrition.carbs }}g</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn-secondary" bindtap="closeWeightModal">å–æ¶ˆ</button>
      <button class="btn-primary" bindtap="confirmAdd">æ·»åŠ </button>
    </view>
  </view>
</view>

<!-- è¿åŠ¨æ—¶é•¿è¾“å…¥å¼¹çª— -->
<view wx:if="{{ showExerciseModal }}" class="modal-overlay" bindtap="closeExerciseModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">{{ selectedExercise.icon }} {{ selectedExercise.name }}</text>
      <button class="modal-close" bindtap="closeExerciseModal">Ã—</button>
    </view>
    
    <view class="modal-body">
      <view class="exercise-summary">
        <text class="exercise-calories-per-min">{{ selectedExercise.caloriesPerMin }}åƒå¡/åˆ†é’Ÿ</text>
        <text class="exercise-category-label">{{ selectedExercise.category }}</text>
      </view>
      
      <view class="duration-input" catchtap="stopPropagation">
        <text class="input-label">è¿åŠ¨æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</text>
        <input class="input" 
               type="number" 
               placeholder="è¯·è¾“å…¥æ—¶é•¿" 
               value="{{ inputDuration }}" 
               bindinput="onDurationInput" 
               catchtap="stopPropagation" />
      </view>
      
      <view class="quick-durations" catchtap="stopPropagation">
        <text class="input-label">å¿«é€Ÿé€‰æ‹©</text>
        <view class="duration-buttons">
          <button wx:for="{{ quickDurations }}" wx:key="*this" 
                  class="btn-secondary duration-btn" 
                  catchtap="selectQuickDuration" 
                  data-duration="{{ item }}">{{ item }}åˆ†é’Ÿ</button>
        </view>
      </view>
      
      <view wx:if="{{ calculatedCalories > 0 }}" class="calories-preview">
        <text class="input-label">æ¶ˆè€—çƒ­é‡é¢„è§ˆ</text>
        <view class="calories-display">
          <text class="calories-number">{{ calculatedCalories }}</text>
          <text class="calories-unit">åƒå¡</text>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn-secondary" bindtap="closeExerciseModal">å–æ¶ˆ</button>
      <button class="btn-primary" bindtap="confirmAddExercise">æ·»åŠ </button>
    </view>
  </view>
</view>